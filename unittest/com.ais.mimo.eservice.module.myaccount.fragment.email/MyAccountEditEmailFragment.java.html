<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>MyAccountEditEmailFragment.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">app</a> &gt; <a href="index.source.html" class="el_package">com.ais.mimo.eservice.module.myaccount.fragment.email</a> &gt; <span class="el_source">MyAccountEditEmailFragment.java</span></div><h1>MyAccountEditEmailFragment.java</h1><pre class="source lang-java linenums">package com.ais.mimo.eservice.module.myaccount.fragment.email;

import android.os.Bundle;
import android.text.InputType;
import android.view.View;
import android.widget.LinearLayout;
import android.widget.TextView;

import com.ais.mimo.eservice.helper.myaccount.network.response.CheckChangeEmailResult;
import com.ais.mimo.eservice.module.register.widget.MyAisRegisterEditText;
import com.ais.mimo.eservice.utility.AnimationViewUtils;
import com.nextzy.myais.common.database.NextzyDatabase;
import com.nextzy.myais.common.mvp.NextzyMvpFragment;
import com.nextzy.myais.common.widget.AISButton;
import com.nextzy.myais.myais.R;

import static com.ais.mimo.eservice.helper.myaccount.network.MyAccountManager.SERVICE_CHECK_CHANGE_EMAIL;

/**
 * Created by TheKhaeng on 11/16/2016.
 */

public class MyAccountEditEmailFragment extends NextzyMvpFragment&lt;MyAccountEditEmailContractor.Presenter&gt; implements MyAccountEditEmailContractor.View {
<span class="nc" id="L24">    public final static String TAG = MyAccountEditEmailFragment.class.getSimpleName();</span>
    private MyAisRegisterEditText edtNewEmail;
    private LinearLayout llOtp;
    private MyAisRegisterEditText edtOtp;
    private LinearLayout llSaveChanges;
    private AISButton btnSaveChanges;
    private AISButton btnCancelSaveChanges;
    private LinearLayout llNext;
    private AISButton btnCancelNext;
    private AISButton btnNext;
    private TextView tvHeaderColumn2;

    public MyAccountEditEmailFragment() {
<span class="nc" id="L37">        super();</span>
<span class="nc" id="L38">    }</span>

    public static MyAccountEditEmailFragment newInstance() {
<span class="nc" id="L41">        MyAccountEditEmailFragment fragment = new MyAccountEditEmailFragment();</span>
<span class="nc" id="L42">        Bundle args = new Bundle();</span>
<span class="nc" id="L43">        fragment.setArguments(args);</span>
<span class="nc" id="L44">        return fragment;</span>
    }

    /*************************/
    /** Fragment life cycle **/
    /*************************/
    //&lt;editor-fold desc=&quot;Life cycle folding&quot;&gt;

    /**
     * onCreate()
     **/
    @Override
    protected void createPresenter() {
<span class="nc" id="L57">        MyAccountEditEmailPresenter.createPresenter(this);</span>
<span class="nc" id="L58">    }</span>

    @Override
    public void restoreArgument(Bundle bundle) {

<span class="nc" id="L63">    }</span>

    /**
     * onViewCreated()
     **/
    @Override
    public void bindView(View view) {
<span class="nc" id="L70">        tvHeaderColumn2 = (TextView) view.findViewById(R.id.my_ais_account_tv_header_column_2);</span>

<span class="nc" id="L72">        edtNewEmail = (MyAisRegisterEditText) view.findViewById(R.id.my_ais_account_edt_new_email);</span>
<span class="nc" id="L73">        llOtp = (LinearLayout) view.findViewById(R.id.my_ais_account_ll_otp);</span>
<span class="nc" id="L74">        edtOtp = (MyAisRegisterEditText) view.findViewById(R.id.my_ais_account_edt_otp);</span>

<span class="nc" id="L76">        llNext = (LinearLayout) view.findViewById(R.id.my_ais_account_ll_next);</span>
<span class="nc" id="L77">        btnCancelNext = (AISButton) view.findViewById(R.id.my_ais_account_btn_cancel_next);</span>
<span class="nc" id="L78">        btnNext = (AISButton) view.findViewById(R.id.my_ais_account_btn_next);</span>

<span class="nc" id="L80">        llSaveChanges = (LinearLayout) view.findViewById(R.id.my_ais_account_ll_save_changes);</span>
<span class="nc" id="L81">        btnSaveChanges = (AISButton) view.findViewById(R.id.my_ais_account_btn_save_changes);</span>
<span class="nc" id="L82">        btnCancelSaveChanges = (AISButton) view.findViewById(R.id.my_ais_account_btn_cancel_save_changes);</span>
<span class="nc" id="L83">    }</span>

    @Override
    public void setupView() {
<span class="nc" id="L87">        showBtnNext();</span>
<span class="nc" id="L88">        edtNewEmail.setInputType(InputType.TYPE_CLASS_TEXT | InputType.TYPE_TEXT_VARIATION_EMAIL_ADDRESS);</span>
<span class="nc" id="L89">        btnNext.setText(getString(R.string.my_ais_account_next_request_otp));</span>
<span class="nc" id="L90">        btnNext.setOnClickListener(view -&gt; clickNext());</span>
<span class="nc" id="L91">        btnSaveChanges.setOnClickListener(view -&gt; clickSaveChanges());</span>
<span class="nc" id="L92">        edtOtp.setInputType(InputType.TYPE_CLASS_NUMBER | InputType.TYPE_NUMBER_VARIATION_PASSWORD);</span>

<span class="nc" id="L94">        btnCancelNext.setOnClickListener(view -&gt; clickBack());</span>
<span class="nc" id="L95">        btnCancelSaveChanges.setOnClickListener(view -&gt; clickBack());</span>
<span class="nc" id="L96">    }</span>


    @Override
    public void initialize() {
<span class="nc" id="L101">        getPresenter().requestEmailMyAccount();</span>
<span class="nc" id="L102">    }</span>


    @Override
    public void restoreView() {
<span class="nc" id="L107">    }</span>

    /**
     * onCreateView
     **/
    @Override
    public int getLayoutView() {
<span class="nc" id="L114">        return R.layout.my_ais_account_fragment_edit_email;</span>
    }


    /**
     * State
     **/
    @Override
    public void saveInstanceState(Bundle outState) {
        // Save Instance State here
<span class="nc" id="L124">    }</span>

    @Override
    public void restoreInstanceState(Bundle savedInstanceState) {
        // Restore instance state here
<span class="nc" id="L129">    }</span>

    //&lt;/editor-fold&gt;

    @Override
    public void updateHeader(String column2) {
<span class="nc bnc" id="L135" title="All 4 branches missed.">        tvHeaderColumn2.setText((column2 == null || column2.isEmpty()) ? &quot;-&quot; : column2);</span>
<span class="nc" id="L136">        dismissAllDialogs();</span>
<span class="nc" id="L137">    }</span>

    @Override
    public void showResponseError(String resultDescription) {
<span class="nc" id="L141">        showResponseExceptionDismiss(resultDescription);</span>
<span class="nc" id="L142">    }</span>

    @Override
    public void showOtpLayout() {
<span class="nc" id="L146">        AnimationViewUtils.getInstance().expand(llOtp);</span>
<span class="nc" id="L147">        edtNewEmail.setEditable(false);</span>
<span class="nc" id="L148">        edtOtp.requestFocus();</span>
<span class="nc" id="L149">        showBtnSaveChanges();</span>
<span class="nc" id="L150">    }</span>

    @Override
    public void hideOtpLayout() {
<span class="nc" id="L154">        AnimationViewUtils.getInstance().collapse(llOtp);</span>
<span class="nc" id="L155">        edtNewEmail.setEditable(true);</span>
<span class="nc" id="L156">        showBtnNext();</span>
<span class="nc" id="L157">    }</span>

    @Override
    public void showChangeEmailSuccess(String resultDescription) {
<span class="nc" id="L161">        dismissDialog();</span>
<span class="nc" id="L162">        showAlertDialogCustomOnClick(resultDescription, (Bundle data) -&gt; {</span>
<span class="nc" id="L163">            getActivity().getSupportFragmentManager().popBackStack();</span>
<span class="nc" id="L164">        });</span>
<span class="nc" id="L165">    }</span>

    @Override
    public void showDefaultEmailEdt() {
<span class="nc" id="L169">        edtNewEmail.showDefault();</span>
<span class="nc" id="L170">    }</span>

    @Override
    public void showDefaultOtpEdt() {
<span class="nc" id="L174">        edtOtp.showDefault();</span>
<span class="nc" id="L175">    }</span>

    @Override
    public void showDialogErrorEmail() {
<span class="nc" id="L179">        edtNewEmail.showError();</span>
        String error;
<span class="nc bnc" id="L181" title="All 2 branches missed.">        if (edtNewEmail.getStringFromEditText().isEmpty()) {</span>
<span class="nc" id="L182">            error = getString(R.string.my_ais_register_dialog_email_none);</span>
        } else {
<span class="nc" id="L184">            error = getString(R.string.my_ais_register_dialog_email_format_fault);</span>
        }
<span class="nc" id="L186">        showResponseError(error);</span>
<span class="nc" id="L187">    }</span>

    @Override
    public void showDialogErrorAlreadyUsedEmail() {
<span class="nc" id="L191">        edtNewEmail.showError();</span>
<span class="nc" id="L192">        String error = getString(R.string.my_ais_register_dialog_already_used_email);</span>
<span class="nc" id="L193">        showResponseError(error);</span>
<span class="nc" id="L194">    }</span>

    @Override
    public void showDialogErrorOtpEdt() {
<span class="nc" id="L198">        edtOtp.showError();</span>
        String error;
<span class="nc bnc" id="L200" title="All 2 branches missed.">        if (edtOtp.getStringFromEditText().isEmpty()) {</span>
<span class="nc" id="L201">            error = getString(R.string.my_ais_register_dialog_otp_none);</span>
        } else {
<span class="nc" id="L203">            error = getString(R.string.my_ais_register_dialog_otp_fault);</span>
        }
<span class="nc" id="L205">        showResponseError(error);</span>
<span class="nc" id="L206">    }</span>

    @Override
    public CheckChangeEmailResult getCheckChangeEmailResultFromDatabase() {
<span class="nc" id="L210">        return NextzyDatabase.getInstance().findByName(SERVICE_CHECK_CHANGE_EMAIL, CheckChangeEmailResult.class);</span>
    }


    public boolean isCanBackPressed() {
<span class="nc bnc" id="L215" title="All 2 branches missed.">        return llOtp.getVisibility() != View.VISIBLE;</span>
    }

    public void backStep() {
<span class="nc bnc" id="L219" title="All 2 branches missed.">        if (llOtp.getVisibility() == View.VISIBLE) {</span>
<span class="nc" id="L220">            hideOtpLayout();</span>
        }
<span class="nc" id="L222">    }</span>

    /********************/
    /** Private method **/
    /********************/
    //&lt;editor-fold desc=&quot;Private function folding&quot;&gt;
    private void showBtnNext() {
<span class="nc" id="L229">        llNext.setVisibility(View.VISIBLE);</span>
<span class="nc" id="L230">        llSaveChanges.setVisibility(View.GONE);</span>
<span class="nc" id="L231">    }</span>

    private void showBtnSaveChanges() {
<span class="nc" id="L234">        llNext.setVisibility(View.GONE);</span>
<span class="nc" id="L235">        llSaveChanges.setVisibility(View.VISIBLE);</span>
<span class="nc" id="L236">    }</span>

    private void clickBack() {
<span class="nc" id="L239">        dismissDialog();</span>
<span class="nc" id="L240">        getActivity().onBackPressed();</span>
<span class="nc" id="L241">    }</span>


    private void clickNext() {
<span class="nc" id="L245">        getPresenter().requestEmailOtp(edtNewEmail.getStringFromEditText());</span>
<span class="nc" id="L246">    }</span>

    private void clickSaveChanges() {
<span class="nc" id="L249">        getPresenter().requestChangeEmail(</span>
<span class="nc" id="L250">                edtNewEmail.getStringFromEditText(),</span>
<span class="nc" id="L251">                edtOtp.getStringFromEditText());</span>
<span class="nc" id="L252">    }</span>

    //&lt;/editor-fold&gt;
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.7.9.201702052155</span></div></body></html>