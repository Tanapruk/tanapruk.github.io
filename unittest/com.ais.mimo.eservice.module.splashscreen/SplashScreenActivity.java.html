<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>SplashScreenActivity.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">app</a> &gt; <a href="index.source.html" class="el_package">com.ais.mimo.eservice.module.splashscreen</a> &gt; <span class="el_source">SplashScreenActivity.java</span></div><h1>SplashScreenActivity.java</h1><pre class="source lang-java linenums">package com.ais.mimo.eservice.module.splashscreen;

import android.Manifest;
import android.content.Intent;
import android.net.Uri;
import android.os.Bundle;
import android.support.annotation.Nullable;
import android.widget.TextView;

import com.ais.mimo.eservice.module.login.activity.LoginActivity;
import com.crashlytics.android.Crashlytics;
import com.nextzy.myais.common.mvp.NextzyMvpActivity;
import com.nextzy.myais.common.permission.NextzyPermission;
import com.nextzy.myais.common.utility.NextzyAndroidUtility;
import com.nextzy.myais.common.widget.dialog.AisDialog;
import com.nextzy.myais.common.widget.dialog.listener.ChoiceDialogClickListener;
import com.nextzy.myais.common.widget.dialog.listener.SimpleDialogClickListener;
import com.nextzy.myais.myais.R;

import java.util.concurrent.TimeUnit;

import io.fabric.sdk.android.Fabric;
import rx.Observable;
import rx.android.schedulers.AndroidSchedulers;
import rx.schedulers.Schedulers;

public class SplashScreenActivity extends NextzyMvpActivity&lt;SplashScreenContractor.Presenter&gt; implements SplashScreenContractor.View {
    private static final String KEY_APP_STORE_URL = &quot;key_app_store_url&quot;;
    private static final String TAG_DIALOG_FORCE_UPDATE = &quot;tag_dialog_force_update&quot;;
    private static final String TAG_DIALOG_GO_TO_MAIN = &quot;tag_dialog_go_to_main&quot;;

    private TextView tvAppVersion;

    @Override
    public int getLayoutView() {
        return R.layout.my_ais_activity_splash_screen;
    }

    @Override
    protected void createPresenter() {
        SplashScreenPresenter.createPresenter(this);
    }

    @Override
    public void bindView() {
        tvAppVersion = (TextView) findViewById(R.id.my_ais_splash_screen_tv_app_version);
    }

    @Override
    public void setupView() {
        tvAppVersion.setText(String.format(&quot;Version %s&quot;, getAppVersion()));
    }

    @Override
    public void restoreArgument(Bundle bundle) {


    }

    @Override
    public void initialize() {
        Fabric.with(this, new Crashlytics());
        getPresenter().checkAppUpdate();
    }



    @Override
    public void restoreInstanceState(Bundle savedInstanceState) {
    }

    @Override
    public void restoreView() {
        // Restore dialog listener state if available
        AisDialog.getInstance().retainSimpleDialogStateIfAvailable(getSupportFragmentManager(), TAG_DIALOG_FORCE_UPDATE, goToAppUpdateUrlDialogClick);
        AisDialog.getInstance().retainSimpleDialogStateIfAvailable(getSupportFragmentManager(), TAG_DIALOG_GO_TO_MAIN, goToMainActivityDialogClick);
    }

    @Override
    public void saveInstanceState(Bundle outState) {

    }

    @Override
    public void showAlertDialogAndGotoAppUpdateUrl(String message, String url) {
        String title = &quot;New Version&quot;;
        Bundle bundle = new Bundle();
        bundle.putString(KEY_APP_STORE_URL, url);
        AisDialog.getInstance().showSimpleDialog(getSupportFragmentManager(), title, message, getString(R.string.ok), bundle, TAG_DIALOG_FORCE_UPDATE, goToAppUpdateUrlDialogClick);
    }

    @Override
    public boolean isActivityVisible() {
        return isVisible();
    }

    @Override
    public String getAppVersion() {
        return NextzyAndroidUtility.getInstance().getAppVersion(this);
    }

    @Override
    public void showAlertDialogUseRoaming() {
        String message = getString(R.string.my_ais_alert_roaming);
        AisDialog.getInstance().showChoiceDialog(
                getSupportFragmentManager(),
                null,
                message,
                getString(R.string.ok),
                getString(R.string.cancel),
<span class="nc" id="L111">                new ChoiceDialogClickListener() {</span>
                    @Override
                    public void onDialogPositiveButtonClick(@Nullable Bundle data) {
                        // TODO1: 11/17/2016 implement save roaming flag
<span class="nc" id="L115">                        getPresenter().waitThenGoToLoginActivity();</span>
<span class="nc" id="L116">                    }</span>

                    @Override
                    public void onDialogNegativeButtonClick(@Nullable Bundle data) {
<span class="nc" id="L120">                        finish();</span>
<span class="nc" id="L121">                    }</span>
                }
        );
    }

    @Override
    public void showAlertDialogAndGotoMainActivity(String message) {
        String title = &quot;New Version&quot;;
        AisDialog.getInstance().showSimpleDialog(getSupportFragmentManager(), title, message, getString(R.string.ok), TAG_DIALOG_GO_TO_MAIN, goToMainActivityDialogClick);
    }

    @Override
    public void checkSmsPermissionBeforeGoToLoginActivity() {
        NextzyPermission.requestPermission(this, permissionResult -&gt; {
            Observable.empty()
                    .delay(500, TimeUnit.MILLISECONDS)
                    .subscribeOn(Schedulers.io())
                    .observeOn(AndroidSchedulers.mainThread())
                    .doOnCompleted(this::goToLoginActivity)
                    .subscribe();
        }, Manifest.permission.RECEIVE_SMS);
    }

    public void goToLoginActivity() {
        openActivity(LoginActivity.class, true);
    }

    public SimpleDialogClickListener goToMainActivityDialogClick = data -&gt; {
        checkSmsPermissionBeforeGoToLoginActivity();
    };

    public SimpleDialogClickListener goToAppUpdateUrlDialogClick = data -&gt; {
        if (data != null) {
            String url = data.getString(KEY_APP_STORE_URL);
            openAppUrl(url);
        }
    };

    private void openAppUrl(String url) {
        startActivity(new Intent(Intent.ACTION_VIEW, Uri.parse(url)));
    }


}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.7.9.201702052155</span></div></body></html>